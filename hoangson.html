<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Nghe Nh·∫°c</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      /* ƒê·ªïi m√†u n·ªÅn cho ph√π h·ª£p v·ªõi giao di·ªán t·ªëi */
      background: #1c1c1e; 
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    h1 {
      color: #fff;
      z-index: 2;
      margin-bottom: 10px; /* ƒê√£ gi·∫£m t·ª´ 20px xu·ªëng 10px */
    }

    /* --- CSS M√î PH·ªéNG GIAO DI·ªÜN IOS (Glassmorphism) --- */
    .player {
      background: rgba(40, 40, 40, 0.7); /* N·ªÅn t·ªëi m·ªù */
      backdrop-filter: blur(20px);        /* Hi·ªáu ·ª©ng l√†m m·ªù n·ªÅn */
      -webkit-backdrop-filter: blur(20px); 
      
      padding: 15px 25px; /* ƒê√£ gi·∫£m padding d·ªçc t·ª´ 20px xu·ªëng 15px */
      border-radius: 40px; /* Bo g√≥c nhi·ªÅu h∆°n */
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1); 
      
      text-align: center;
      width: 320px;
      color: white; 
      z-index: 2;
      position: relative;
      
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Khung m√†n h√¨nh ƒëen (video/lyrics) */
    .video-frame {
      width: 100%;
      height: 220px; /* ƒê√É GI·∫¢M CHI·ªÄU CAO T·ª™ 300PX XU·ªêNG 220PX */
      background: black;
      border-radius: 25px;
      margin-bottom: 15px; /* ƒê√£ gi·∫£m t·ª´ 20px xu·ªëng 15px */
      overflow: hidden; /* ƒê·ªÉ ·∫£nh b√¨a kh√¥ng b·ªã tr√†n */
    }

    .cover {
      width: 100%;
      height: 100%;
      object-fit: cover;
      /* ƒê√£ lo·∫°i b·ªè border-radius c≈© */
      margin-bottom: 0; 
    }

    /* ·∫®n b·ªô ƒëi·ªÅu khi·ªÉn HTML m·∫∑c ƒë·ªãnh */
    audio {
        display: none;
    }
    
    /* C√°c n√∫t ƒëi·ªÅu khi·ªÉn t√πy ch·ªânh (Next, Previous, Play/Pause) */
    .controls {
        display: flex;
        justify-content: space-around;
        align-items: center;
        width: 100%;
        margin-top: 15px;
        margin-bottom: 25px;
    }

    .controls button {
        background: none;
        border: none;
        color: white;
        font-size: 35px;
        cursor: pointer;
        opacity: 0.9;
        transition: opacity 0.1s;
    }

    #playPauseBtn {
        font-size: 50px; /* N√∫t play l·ªõn h∆°n */
    }

    .controls button:hover {
        opacity: 1;
    }

    /* Thanh ƒëi·ªÅu ch·ªânh ti·∫øn ƒë·ªô v√† √¢m l∆∞·ª£ng (Slider Bar) */
    .slider-container {
        width: 100%;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .slider-container span {
        font-size: 12px;
        font-weight: bold;
        color: rgba(255, 255, 255, 0.7);
    }

    /* C√†i ƒë·∫∑t thanh tr∆∞·ª£t (input type="range") */
    input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        height: 4px; 
        background: rgba(255, 255, 255, 0.4);
        border-radius: 2px;
        margin: 0 10px;
        cursor: pointer;
    }

    /* N√∫t k√©o (Thumb) c·ªßa thanh tr∆∞·ª£t */
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 12px;
        width: 12px;
        border-radius: 50%;
        background: white;
    }
    
    /* ƒê·∫£m b·∫£o Playlist v·∫´n hi·ªÉn th·ªã ƒë√∫ng */
    ul {
      list-style: none;
      padding: 0;
      margin: 20px 0 0 0;
      width: 100%;
    }

    li {
      margin: 10px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 5px;
      border-radius: 8px;
      transition: background 0.3s, color 0.3s;
      color: white; /* ƒê·ªïi m√†u ch·ªØ trong list */
    }

    li:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    li img {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      margin-right: 10px;
      object-fit: cover;
    }

    /* Icon bay */
    .icon {
      position: absolute;
      font-size: 24px;
      pointer-events: none;
      animation-name: float;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
    }

    @keyframes float {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) translateX(var(--x)) scale(var(--scale));
        opacity: 0;
      }
    }
  </style>
</head>
<body>

  <h1>Chill c√πng hoangson</h1>

  <div class="player">
    <div class="video-frame">
        <img id="currentCover" src="mqdefault.jpg" alt="Current Song" class="cover">
    </div>
    
    <div class="slider-container">
        <span id="currentTimeDisplay">0:00</span>
        <input type="range" id="progress-bar" value="0" min="0" max="100">
        <span id="durationDisplay">-0:00</span>
    </div>
    
    <div class="controls">
        <button id="prevBtn">‚èÆÔ∏è</button>
        <button id="playPauseBtn">‚èØÔ∏è</button>
        <button id="nextBtn">‚è≠Ô∏è</button>
    </div>
    
    <div class="slider-container" style="margin-top: 0; margin-bottom: 10px;">
        <span style="font-size: 18px;">üîà</span>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
        <span style="font-size: 18px;">üîä</span>
    </div>
    
    <audio id="audio">
      Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ audio.
    </audio>

    <ul id="playlist">
    </ul>
  </div>

  <script>
    // --- Khai b√°o bi·∫øn ---
    const mainAudio = document.getElementById('audio');
    const currentCover = document.getElementById('currentCover');
    const playlistEl = document.getElementById('playlist');

    // Khai b√°o c√°c bi·∫øn DOM m·ªõi
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressBar = document.getElementById('progress-bar');
    const volumeSlider = document.getElementById('volume-slider');
    const currentTimeDisplay = document.getElementById('currentTimeDisplay');
    const durationDisplay = document.getElementById('durationDisplay');

    // DANH S√ÅCH B√ÄI
    const tracks = [
      { file: "Iframe 07. Th√¥i Em ƒê·ª´ng ƒêi - RPT MCK ( ft. Trung Tr·∫ßn ) _ _ 99_ _ the album [6fzH7a3XQW0].mp3", cover: "fdd9b0c6-786f-4bce-a3a0-4d78ebab5c22.jpg", title: "B√†i h√°t 1" },
      { file: "Iframe 'bao ti·ªÅn m·ªôt m·ªõ b√¨nh y√™n_' - 14 Casper & Bon Nghi√™m (Official) (Track 09 - Album 'S·ªê KH√îNG') [vVhKA9Av6vA].mp3", cover: "f93bb374f3946da022a3c19a52adc66e.jpg", title: "B√†i h√°t 2" },
      { file: "bai_hat_so_3.mp3", cover: "cbc7eff5-0923-4354-a46f-c64003390706.jpg", title: "B√†i h√°t 3" }
    ];

    let currentIndex = 0;
    const FADE_DURATION = 800; // ms
    
    // --- H√†m ti·ªán √≠ch ---

    // H√†m chuy·ªÉn ƒë·ªïi gi√¢y sang ƒë·ªãnh d·∫°ng M:SS
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = Math.floor(seconds % 60);
      return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
    }

    // --- Ch·ª©c nƒÉng ƒëi·ªÅu khi·ªÉn nh·∫°c ---

    // build playlist UI (gi·ªØ nguy√™n)
    function buildPlaylist() {
      playlistEl.innerHTML = "";
      tracks.forEach((t, i) => {
        const li = document.createElement('li');
        li.innerHTML = `<img src="${t.cover}" alt="${t.title}"><span>${t.title}</span>`;
        li.addEventListener('click', () => playTrack(i, true)); 
        playlistEl.appendChild(li);
      });
    }

    // fade out current audio, ƒë·ªïi file, fade in (gi·ªØ nguy√™n)
    function fadeTo(newIndex, duration = FADE_DURATION) {
      const steps = 20;
      const stepTime = duration / steps;
      const startVol = mainAudio.volume || 1;
      let i = 0;

      const fadeOut = setInterval(() => {
        i++;
        mainAudio.volume = Math.max(0, startVol * (1 - i / steps));
        if (i >= steps) {
          clearInterval(fadeOut);
          
          const track = tracks[newIndex];
          mainAudio.src = track.file;
          currentCover.src = track.cover;
          mainAudio.currentTime = 0;
          
          // C·∫≠p nh·∫≠t n√∫t play/pause
          playPauseBtn.textContent = '‚è∏Ô∏è'; 
          
          mainAudio.play().catch(()=>{}); 
          
          let j = 0;
          const fadeIn = setInterval(() => {
            j++;
            mainAudio.volume = Math.min(1, startVol * (j / steps));
            if (j >= steps) clearInterval(fadeIn);
          }, stepTime);
        }
      }, stepTime);
    }

     // ph√°t b√†i (gi·ªØ nguy√™n, nh∆∞ng th√™m c·∫≠p nh·∫≠t n√∫t)
    function playTrack(index, useFade = false) {
      if (index < 0 || index >= tracks.length) return;
      currentIndex = index;
      const track = tracks[index];

      // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t Play
      playPauseBtn.textContent = '‚è∏Ô∏è'; 

      if (mainAudio.paused && !mainAudio.src) {
        mainAudio.src = track.file;
        currentCover.src = track.cover;
        mainAudio.volume = 1;
        mainAudio.play().catch(()=>{});
      } else if (useFade) {
        fadeTo(index);
      } else {
        mainAudio.src = track.file;
        currentCover.src = track.cover;
        mainAudio.volume = 1;
        mainAudio.play().catch(()=>{});
      }
    }
    
    // --- X·ª≠ l√Ω s·ª± ki·ªán cho c√°c n√∫t ƒëi·ªÅu khi·ªÉn m·ªõi ---

    // 1. N√∫t Play/Pause
    playPauseBtn.addEventListener('click', () => {
        if (!mainAudio.src) {
            // N·∫øu ch∆∞a c√≥ b√†i n√†o, ph√°t b√†i ƒë·∫ßu ti√™n
            playTrack(currentIndex, false);
            return;
        }

        if (mainAudio.paused) {
            mainAudio.play();
            playPauseBtn.textContent = '‚è∏Ô∏è';
        } else {
            mainAudio.pause();
            playPauseBtn.textContent = '‚èØÔ∏è';
        }
    });

    // 2. N√∫t Next
    nextBtn.addEventListener('click', () => {
        const next = (currentIndex + 1) % tracks.length;
        playTrack(next, true); 
    });
    
    // 3. N√∫t Previous
    prevBtn.addEventListener('click', () => {
        // Quay l·∫°i b√†i tr∆∞·ªõc, ho·∫∑c v·ªÅ ƒë·∫ßu b√†i hi·ªán t·∫°i n·∫øu ƒë√£ ph√°t ƒë∆∞·ª£c 3 gi√¢y
        if (mainAudio.currentTime < 3) {
             const prev = (currentIndex - 1 + tracks.length) % tracks.length;
             playTrack(prev, true);
        } else {
            mainAudio.currentTime = 0;
        }
    });
    
    // 4. Thanh √Çm l∆∞·ª£ng
    volumeSlider.addEventListener('input', () => {
        mainAudio.volume = volumeSlider.value;
    });

    // 5. Thanh Ti·∫øn tr√¨nh (k√©o)
    progressBar.addEventListener('input', () => {
        const seekTime = (progressBar.value / 100) * mainAudio.duration;
        mainAudio.currentTime = seekTime;
    });

    // --- C·∫≠p nh·∫≠t UI khi nh·∫°c ch·∫°y ---

    mainAudio.addEventListener('loadedmetadata', () => {
        // C·∫≠p nh·∫≠t gi√° tr·ªã Max v√† th·ªùi l∆∞·ª£ng hi·ªÉn th·ªã khi b√†i h√°t ƒë∆∞·ª£c t·∫£i
        progressBar.max = 100;
        durationDisplay.textContent = '-' + formatTime(mainAudio.duration);
    });

    mainAudio.addEventListener('timeupdate', () => {
        if (!isNaN(mainAudio.duration)) {
            // C·∫≠p nh·∫≠t thanh ti·∫øn tr√¨nh
            const progress = (mainAudio.currentTime / mainAudio.duration) * 100;
            progressBar.value = progress;
            
            // C·∫≠p nh·∫≠t th·ªùi gian ƒë√£ qua v√† th·ªùi gian c√≤n l·∫°i
            currentTimeDisplay.textContent = formatTime(mainAudio.currentTime);
            durationDisplay.textContent = '-' + formatTime(mainAudio.duration - mainAudio.currentTime);
        }
    });

    mainAudio.addEventListener('pause', () => {
        playPauseBtn.textContent = '‚èØÔ∏è';
    });
    
    mainAudio.addEventListener('play', () => {
        playPauseBtn.textContent = '‚è∏Ô∏è';
    });


    // next t·ª± ƒë·ªông khi h·∫øt b√†i (gi·ªØ nguy√™n)
    mainAudio.addEventListener('ended', () => {
      const next = (currentIndex + 1) % tracks.length;
      playTrack(next, true);
    });

     // --- Hi·ªáu ·ª©ng Icon bay ---
    const icons = ['üéµ', 'üé∂', 'üíñ', 'üé∏', 'üéπ'];

    function createIcon() {
      // ƒê√É S·ª¨A: D√πng mainAudio thay v√¨ audio ƒë·ªÉ li√™n k·∫øt ƒë√∫ng v·ªõi th·∫ª <audio>
      if (!mainAudio.paused) { 
        const icon = document.createElement('div');
        icon.classList.add('icon');
        icon.textContent = icons[Math.floor(Math.random() * icons.length)];

        icon.style.left = Math.random() * window.innerWidth + 'px';
        icon.style.bottom = '-30px';

        const deltaX = (Math.random() - 0.5) * 200;
        const scale = Math.random() * 0.8 + 0.5;
        const duration = Math.random() * 2 + 3;

        icon.style.setProperty('--x', deltaX + 'px');
        icon.style.setProperty('--scale', scale);
        icon.style.animationDuration = duration + 's';

        document.body.appendChild(icon);

        setTimeout(() => {
          icon.remove();
        }, duration * 1000);
      }
    }

    // --- Kh·ªüi t·∫°o ---
    buildPlaylist();
    setInterval(createIcon, 300);
  </script>
  
</body>
</html>
